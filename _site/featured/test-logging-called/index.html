<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://use.fontawesome.com/021da17a9a.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">

  <link rel="stylesheet" type="text/css" media="all" href="/assets/css/style.css"  />
  <link rel="stylesheet" href="/assets/main.css">

  <link rel="shortcut icon" href="/assets/images/FR.svg" width="16" heigth="16">


  <link rel="alternate" type="application/rss+xml" title="Fabio Rosado" href="/feed.xml">
  
</head>


  <body>

    <header class="site-header" role="banner">
  <nav class="navbar">
    <a class="navbar-brand" href="http://localhost:4000">
      <img src="http://localhost:4000/assets/images/FR.svg" width="30" height="30" class="d-inline-block align-top" alt="FabioRosado">
    </a>
    <ul class="nav justify-content-center">
    <li class="nav-item">
      <a class="nav-link" href="/">Home</a>
    </li>

    
      
    
      
          <li class="nav-item">
              <a class="nav-link" href="/about/"> About</a>
          </li>
      
    
      
          <li class="nav-item">
              <a class="nav-link" href="/blog/"> Blog</a>
          </li>
      
    
      
          <li class="nav-item">
              <a class="nav-link" href="/projects/"> Projects</a>
          </li>
      
    
      
    
      
    
      
    
  </ul>
  </nav>
</header>


    <main class="page-content" aria-label="Content">

        <div class="wrapper">
 <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
   <header class="post-header">
     <h1 class="post-title" itemprop="name headline">Test: Was Logging called</h1>
     <h3 class="text-muted"> </h3>
     <p class="post-meta">
       <time datetime="2017-09-14T12:01:02+01:00" itemprop="datePublished">
         
           <i class="fa fa-clock-o" aria-hidden="true"></i> &nbsp;Thursday, 14 Sep 2017 &emsp;
       </time>

       <i class="fa fa-user-o" aria-hidden="true"></i>
         <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">&nbsp;FabioRosado &emsp;</span></span>
       <i class="fa fa-folder-o" aria-hidden="true"></i> &nbsp;Featured
     </p>

   </header>

   <div class="post-content" itemprop="articleBody">
     <p>While creating a function that uses <code class="highlighter-rouge">logging.info</code> to log useful information on the first run of <a href="https://github.com/opsdroid/opsdroid">Opsdroid</a> the percentage of <code class="highlighter-rouge">coverall</code> dropped quite a bit. To counter that a test had to be created to assert if the <code class="highlighter-rouge">logging.info</code> was called or not.</p>

<p>Opsdroid uses a file named <code class="highlighter-rouge">configuration.yml</code> to keep track of all the configuration details. Upon the suggestion of Jacob(the creator and maintainer of the project) a <code class="highlighter-rouge">welcome-message: true</code> line was added to the configuration file in case the user wishes to hide the welcome message.</p>

<p> </p>
<h3 id="the-function">The Function</h3>
<hr />
<p> </p>

<p>The <code class="highlighter-rouge">welcome_message</code> function is a very basic function that uses the <code class="highlighter-rouge">logging.info</code> to log a quick get started information about Opsdroid.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="mi">1</span>  <span class="k">def</span> <span class="nf">welcome_message</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
<span class="mi">2</span>      <span class="s">"""Add welcome message if set to true in configuration."""</span>
<span class="mi">3</span>      <span class="k">try</span><span class="p">:</span>
<span class="mi">4</span>          <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s">'welcome-message'</span><span class="p">]:</span>
<span class="mi">5</span>              <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<span class="mi">6</span>              <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"You can customise your opsdroid by modifying "</span>
<span class="mi">7</span>                          <span class="s">"your configuration.yaml"</span><span class="p">)</span>
<span class="mi">8</span>              <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Read more at: "</span>
<span class="mi">9</span>                          <span class="s">"http://opsdroid.readthedocs.io/#configuration"</span><span class="p">)</span>
<span class="mi">10</span>             <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Watch the Get Started Videos at: "</span>
<span class="mi">11</span>                         <span class="s">"http://bit.ly/2fnC0Fh"</span><span class="p">)</span>
<span class="mi">12</span>             <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Install Opsdroid Desktop at: "</span>
<span class="mi">13</span>                         <span class="s">"https://github.com/opsdroid/opsdroid-desktop/releases"</span><span class="p">)</span>
<span class="mi">14</span>             <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
<span class="mi">15</span>     <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
<span class="mi">16</span>         <span class="k">pass</span></code></pre></figure>

<p> </p>
<h3 id="the-test">The Test</h3>
<hr />
<p> </p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="mi">1</span>   <span class="k">def</span> <span class="nf">test_welcome_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="mi">2</span>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s">"welcome-message"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="mi">3</span>    <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'opsdroid.__main__.LOGGER.info'</span><span class="p">)</span> <span class="k">as</span> <span class="n">logmock</span><span class="p">:</span>
<span class="mi">4</span>      <span class="n">opsdroid</span><span class="o">.</span><span class="n">welcome_message</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="mi">5</span>      <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">logmock</span><span class="o">.</span><span class="n">called</span><span class="p">)</span></code></pre></figure>

<ul>
  <li>We start the function by creating a dummy config file that will always return the welcome message.</li>
  <li>On line 3 we patch the <code class="highlighter-rouge">LOGGER.info</code> call from <code class="highlighter-rouge">opsdroid__main__</code> (where the welcome_message function is located)</li>
  <li>On line 4 we make a call to the <code class="highlighter-rouge">welcome_message</code> function using the dummy config file (which will always return the <code class="highlighter-rouge">LOGGER.info</code> lines)</li>
  <li>On line 5 <code class="highlighter-rouge">logmock.called</code> will return a boolean whether the mocked object has been called. Since we are sure that the dummy config file will always return True we do a simple <code class="highlighter-rouge">assertTrue</code> to see if <code class="highlighter-rouge">opsdroid.__main__.LOGGER.info</code> was called.</li>
</ul>

<p> </p>
<h3 id="final-thoughts">Final Thoughts</h3>
<hr />
<p> </p>

<p>This was the best I could come up with to test if the <code class="highlighter-rouge">logging.info</code> method was called.
Have you ever came up with the need to assert if this method was called successfully? How did you solve this issue?</p>

<p> </p>

   </div>

   <div>
       <hr></br>
       <div class="row">
           <div class="col-md-3">
             <h5>Share this on: </h5>
           </div>
           <div class="col">
             <a href="https://twitter.com/intent/tweet?text=Test: Was Logging called&url=http://localhost:4000/featured/test-logging-called/&via=@FabioRosado_&related=@FabioRosado_" rel="nofollow" target="_blank" title="Share on Twitter">
               <button type="button" class="btn btn-info btn-sm"><i class="fa fa-twitter fa-share" aria-hidden="true"></i> Twitter</button></a>
             <a href="https://facebook.com/sharer.php?u=http://localhost:4000/featured/test-logging-called/" rel="nofollow" target="_blank" title="Share on Facebook">
               <button type="button" class="btn btn-primary btn-sm"> <i class="fa fa-facebook fa-share" aria-hidden="true"></i> Facebook</button></a>
             <a href="https://plus.google.com/share?url=http://localhost:4000/featured/test-logging-called/" rel="nofollow" target="_blank" title="Share on Google+">
               <button type="button" class="btn btn-danger btn-sm"><i class="fa fa-google-plus fa-share" aria-hidden="true"></i> Google+</button></a>
             <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/featured/test-logging-called/&title=Test: Was Logging called" rel="nofollow" target="_blank" title="Share on Linkedin">
               <button type="button" class="btn btn-primary btn-sm"><i class="fa fa-linkedin fa-share" aria-hidden="true"></i> Linkedin</button></a>
           </div>
       </div>
        </br>
   </div>
   <div>
     <hr></br></br>
      <div clas="row">
        <div id="disqus_thread"></div>
          <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            function disqus_config() { this.experiment.enable_scroll_container = true; }
            var disqus_shortname = "fabiorosado"; // required: replace example with your forum shortname
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
     </div>
   </div>
 </article>

</div>


    </main>

    <footer class="site-footer">

  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <img src="http://localhost:4000/assets/images/FR.svg" width="100" height="100" alt="FabioRosado">
      </div>
      <div class="col-3">
        <h2 class="footer-heading"> Pages</h2>
          <ul class="contact-list">
              <li><a href="http://localhost:4000"> Home </a> </li>
              
                  
              
                  
                      <li><a href="/about/"> About </a></li>
                  
              
                  
                      <li><a href="/blog/"> Blog </a></li>
                  
              
                  
                      <li><a href="/projects/"> Projects </a></li>
                  
              
          </ul>
      </div>
      <div class="col-4">
        <h2 class="footer-heading"> Latest Posts</h2>
          <ul class="contact-list">
              
                 
                       <li><a href="/github/commit-history/"> Commit history </a></li>
                 
              
                 
                       <li><a href="/code%20adventures/hacktoberfest/"> Hacktoberfest </a></li>
                 
              
                 
                   
              
                 
                   
              
          </ul>
      </div>
      <div class="col-3">
       <h2 class="footer-heading"> Contact</h2>
       <ul class="contact-list">
         <li>Please feel free to contact me, I'm always happy to chat!</li>
           <li><i class="fa fa-envelope" aria-hidden="true"></i> <a href="mailto:fabiorosado@outlook.com">fabiorosado@outlook.com</a></li>
           <li>&emsp;&emsp;&emsp;<a href="https://github.com/FabioRosado" target="_blank"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a>
<a href="https://twitter.com/FabioRosado_" target="_blank"><i class="fa fa-twitter-square fa-lg" aria-hidden="true"></i></a>
<a href="https://www.linkedin.com/in/fabiorosado/" target="_blank"><i class="fa fa-linkedin-square fa-lg" aria-hidden="true"></i></a>
<a href="https://www.instagram.com/fabiorosado/" target="_blank"><i class="fa fa-instagram fa-lg" aria-hidden="true"></i></a>
 </li>
       </ul>
      </div>
    </div>
  </div>

</footer>

<div id="bottom-bar" class="container-fluid">
    <div class="row">
        <div class="col" align="left">
            Made with <i class="fa fa-heart"></i> using <a href="http://jekyllrb.com/">Jekyll</a>
        </div>
        <div class="col" align="right">
            <i class="fa fa-code"></i> on <a href="https://github.com/fabiorosado/fabiorosado.github.io/">Github  </a> &nbsp;<i class="fa fa-github-alt"></i>
        </div>
    </div>
</div>


  </body>

</html>
